<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolusiBK - Aplikasi Konseling & OSIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Tambahkan Supabase Client -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        window.supabase = createClient;
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .sidebar-link:hover {
            background-color: #047857; /* a darker green */
        }
        .sidebar-link-active {
            background-color: #065f46; /* an even darker green for active state */
            font-weight: 600;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f0fdf4;
        }
        ::-webkit-scrollbar-thumb {
            background: #34d399;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #10b981;
        }
        .prose { max-width: none; }
        .prose h1, .prose h2, .prose h3, .prose h4 { color: #064e3b; }
        .prose p { margin-bottom: 1rem; }
        .prose ul, .prose ol { list-style-position: inside; padding-left: 1rem;}
        .prose li { margin-bottom: 0.5rem; }

        @keyframes wobble {
            0%, 100% { transform: translateY(0) rotate(0); }
            25% { transform: translateY(-5px) rotate(-2deg); }
            50% { transform: translateY(0) rotate(2deg); }
            75% { transform: translateY(5px) rotate(0); }
        }
        .login-button-theme {
            animation: wobble 6s ease-in-out infinite;
            background: linear-gradient(45deg, #a7f3d0, #6ee7b7, #34d399);
            transition: all 0.3s ease;
            color: #064e3b;
        }
        .login-button-theme:hover {
            box-shadow: 0 15px 25px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        .btn-glow-green:hover { box-shadow: 0 0 12px 2px rgba(34, 197, 94, 0.4); }
        .btn-glow-red:hover { box-shadow: 0 0 12px 2px rgba(239, 68, 68, 0.4); }
        .btn-glow-gray:hover { box-shadow: 0 0 12px 2px rgba(107, 114, 128, 0.3); }

        /* Chat styles */
        .chat-bubble-sent {
            background-color: #059669;
            color: white;
            border-radius: 1rem 1rem 0.25rem 1rem;
        }
        .chat-bubble-received {
            background-color: #e5e7eb;
            color: #1f2937;
            border-radius: 1rem 1rem 1rem 0.25rem;
        }
    </style>
</head>
<body class="bg-emerald-50">
    <div id="app" class="transition-all duration-300 flex items-center justify-center h-screen">
        <i data-lucide="loader-2" class="animate-spin w-12 h-12 text-emerald-500"></i>
    </div>

    <script type="module">
        // --- INISIALISASI SUPABASE ---
        const SUPABASE_URL = 'https://zkcsplphwwhzpzxsfxme.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InprY3NwbHBod3doenB6eHNmeG1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzODE4NjgsImV4cCI6MjA3NTk1Nzg2OH0.8s_rN22NLrN8Rl1N9Ne0n0KqX8FOItcTNBryv_PxhEY';
        
        if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
            document.getElementById('app').innerHTML = `<div class="text-center p-8 bg-white rounded-lg shadow-xl max-w-2xl mx-auto"><h1 class="text-2xl font-bold text-red-600">Konfigurasi Database Gagal!</h1><p class="mt-4 text-gray-700">Pastikan variabel SUPABASE_URL dan SUPABASE_ANON_KEY di dalam kode sudah terisi dengan benar.</p></div>`;
            throw new Error("Supabase URL and Key not configured.");
        }

        const supabase = window.supabase(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // --- APLIKASI UTAMA ---
        const app = document.getElementById('app');

        // --- STATE MANAGEMENT ---
        const state = {
            currentUser: null,
            currentPage: 'dashboard',
            activeChatPartner: null, // {id, name}
            messages: [],
            messageSubscription: null,
            modal: {
                isOpen: false,
                header: '',
                content: ''
            }
        };

        // --- FUNGSI UTAMA RENDER ---
        async function render() {
            lucide.createIcons();
            if (state.modal.isOpen) {
                renderModal();
            } else {
                const existingModal = document.getElementById('modal-backdrop');
                if (existingModal) existingModal.remove();
            }

            if (!state.currentUser) {
                app.innerHTML = LoginPage();
                attachLoginListener();
                return;
            }

            const sidebar = Sidebar();
            let content = '';
            
            const role = state.currentUser.role;
            switch(role) {
                case 'siswa':
                    switch (state.currentPage) {
                        case 'dashboard': content = await SiswaDashboard(); break;
                        case 'janji-temu': content = await SiswaJanjiTemu(); break;
                        case 'materi-bk': content = await SiswaMateriBk(); break;
                        case 'chat-konseling': content = await SiswaChat(); break;
                        default: state.currentPage = 'dashboard'; content = await SiswaDashboard();
                    }
                    break;
                case 'guru_bk':
                     switch (state.currentPage) {
                        case 'dashboard': content = await GuruBKDashboard(); break;
                        case 'janji-temu': content = await GuruBKJanjiTemu(); break;
                        case 'chat-siswa': content = await GuruBKChat(); break;
                        default: state.currentPage = 'dashboard'; content = await GuruBKDashboard();
                    }
                    break;
                 case 'admin':
                    switch (state.currentPage) {
                        case 'dashboard': content = await AdminDashboard(); break;
                        case 'kelola-pengguna': content = await AdminKelolaPengguna(); break;
                        case 'kelola-materi': content = await AdminKelolaMateri(); break;
                        default: state.currentPage = 'dashboard'; content = await AdminDashboard();
                    }
                    break;
                default:
                    content = `<h3 class="text-3xl font-semibold text-emerald-900">Selamat Datang, ${state.currentUser.name}!</h3><p>Peran Anda (${role}) belum memiliki halaman khusus.</p>`;
            }
            
            app.innerHTML = `
                <div class="flex h-screen bg-gray-100">
                    ${sidebar}
                    <div class="flex-1 flex flex-col overflow-hidden">
                        ${Header()}
                        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-emerald-50">
                            <div class="container mx-auto px-6 py-8">
                                ${content}
                            </div>
                        </main>
                    </div>
                </div>
            `;
            attachEventListeners();
            lucide.createIcons();
        }
        
        // --- EVENT LISTENERS ---
        function attachEventListeners() {
            document.getElementById('logout-btn')?.addEventListener('click', handleLogout);
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    // Hentikan subscription chat jika pindah halaman
                    if (state.messageSubscription) {
                        supabase.removeChannel(state.messageSubscription);
                        state.messageSubscription = null;
                        state.activeChatPartner = null;
                    }
                    state.currentPage = e.currentTarget.getAttribute('data-page');
                    render();
                });
            });

            const role = state.currentUser.role;
            if (role === 'siswa') {
                if (state.currentPage === 'janji-temu') attachSiswaJanjiTemuListeners();
                if (state.currentPage === 'materi-bk') attachSiswaMateriBkListeners();
                if (state.currentPage === 'chat-konseling') attachChatListeners();
            } else if (role === 'guru_bk') {
                if(state.currentPage === 'janji-temu') attachGuruBKJanjiTemuListeners();
                if(state.currentPage === 'chat-siswa') attachChatListeners();
            } else if (role === 'admin') {
                if (state.currentPage === 'kelola-pengguna') attachAdminKelolaPenggunaListeners();
                if (state.currentPage === 'kelola-materi') attachAdminKelolaMateriListeners();
            }
        }
        
        // --- LOGIN & LOGOUT ---
        function LoginPage() { return `<div class="min-h-screen bg-emerald-800 flex items-center justify-center p-4"><div class="w-full max-w-md"><div class="bg-white rounded-2xl shadow-2xl p-8 md:p-12"><div class="flex flex-col items-center text-center mb-8"><i data-lucide="leaf" class="w-16 h-16 text-emerald-600 mb-4"></i><h1 class="text-3xl font-bold text-emerald-900">Selamat Datang di SolusiBK</h1></div><form id="login-form" class="space-y-6"><div><label for="email" class="text-sm font-medium text-gray-700">Email</label><input type="email" id="email" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="contoh: admin@solusibk.com" required></div><div><label for="password" class="text-sm font-medium text-gray-700">Password</label><input type="password" id="password" class="w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="••••••••" required></div><p id="login-error" class="text-red-500 text-sm text-center hidden"></p><button type="submit" class="w-full font-semibold py-3 rounded-lg shadow-lg active:scale-95 login-button-theme">Masuk</button></form></div></div></div>`; }
        function attachLoginListener() { document.getElementById('login-form')?.addEventListener('submit', handleLogin); }
        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorEl = document.getElementById('login-error');
            const button = event.target.querySelector('button');
            button.disabled = true;
            button.innerHTML = '<i data-lucide="loader-2" class="animate-spin w-5 h-5 mx-auto"></i>';
            lucide.createIcons();
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) {
                errorEl.textContent = "Email atau password salah.";
                errorEl.classList.remove('hidden');
                button.disabled = false;
                button.textContent = "Masuk";
            } else if (data.user) {
                await fetchUserProfile(data.user);
                render();
            }
        }
        async function handleLogout() {
            if (state.messageSubscription) {
                supabase.removeChannel(state.messageSubscription);
                state.messageSubscription = null;
            }
            await supabase.auth.signOut();
            state.currentUser = null;
            state.currentPage = 'dashboard';
            state.activeChatPartner = null;
            render();
        }
        async function fetchUserProfile(user) {
            const { data, error } = await supabase.from('profiles').select('name, role').eq('id', user.id);
            if (error) { console.error("Error querying profile:", error); handleLogout(); return; }
            if (data && data.length > 0) {
                state.currentUser = { ...user, ...data[0] };
            } else {
                 // Pesan error ini sudah ditangani oleh notifikasi di bawah.
                 // console.error("Error fetching profile: No profile found for user ID:", user.id);
                 showNotification("Profil pengguna tidak ditemukan. Silakan hubungi admin.", "error");
                 handleLogout();
            }
        }

        // --- KOMPONEN UTAMA ---
        function Header() { return `<header class="flex justify-between items-center py-4 px-6 bg-white border-b-2 border-emerald-100"><div class="flex items-center"><h1 class="text-xl font-semibold text-emerald-800">${state.currentUser.name} <span class="text-sm font-normal text-gray-500">(${state.currentUser.role.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())})</span></h1></div><div class="flex items-center"><button id="logout-btn" class="font-semibold text-red-500 hover:text-red-700 transition-all duration-200 hover:scale-105 flex items-center gap-2"><i data-lucide="log-out" class="w-5 h-5"></i>Logout</button></div></header>`; }
        function Sidebar() {
            const role = state.currentUser.role;
            let links = '';
            if (role === 'siswa') {
                links = `
                    <a href="#" data-page="dashboard" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg ${state.currentPage === 'dashboard' ? 'sidebar-link-active' : ''}"><i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>Dashboard</a>
                    <a href="#" data-page="janji-temu" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg ${state.currentPage === 'janji-temu' ? 'sidebar-link-active' : ''}"><i data-lucide="calendar-plus" class="w-5 h-5 mr-3"></i>Buat Janji Temu</a>
                    <a href="#" data-page="materi-bk" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg ${state.currentPage === 'materi-bk' ? 'sidebar-link-active' : ''}"><i data-lucide="book-open" class="w-5 h-5 mr-3"></i>Materi BK</a>
                    <a href="#" data-page="chat-konseling" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg ${state.currentPage === 'chat-konseling' ? 'sidebar-link-active' : ''}"><i data-lucide="message-square" class="w-5 h-5 mr-3"></i>Chat Konseling</a>
                `;
            } else if (role === 'guru_bk') {
                 links = `
                    <a href="#" data-page="dashboard" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg ${state.currentPage === 'dashboard' ? 'sidebar-link-active' : ''}"><i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>Dashboard</a>
                    <a href="#" data-page="janji-temu" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg ${state.currentPage === 'janji-temu' ? 'sidebar-link-active' : ''}"><i data-lucide="calendar-check" class="w-5 h-5 mr-3"></i>Kelola Janji Temu</a>
                    <a href="#" data-page="chat-siswa" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg ${state.currentPage === 'chat-siswa' ? 'sidebar-link-active' : ''}"><i data-lucide="message-square" class="w-5 h-5 mr-3"></i>Chat Siswa</a>
                `;
            } else if (role === 'admin') {
                 links = `
                    <a href="#" data-page="dashboard" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg ${state.currentPage === 'dashboard' ? 'sidebar-link-active' : ''}"><i data-lucide="shield" class="w-5 h-5 mr-3"></i>Dashboard Admin</a>
                    <a href="#" data-page="kelola-pengguna" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg ${state.currentPage === 'kelola-pengguna' ? 'sidebar-link-active' : ''}"><i data-lucide="users" class="w-5 h-5 mr-3"></i>Kelola Pengguna</a>
                    <a href="#" data-page="kelola-materi" class="sidebar-link flex items-center px-4 py-2.5 rounded-lg ${state.currentPage === 'kelola-materi' ? 'sidebar-link-active' : ''}"><i data-lucide="book-marked" class="w-5 h-5 mr-3"></i>Kelola Materi BK</a>
                `;
            }
            return `<aside class="w-64 flex-shrink-0 bg-emerald-800 text-white flex flex-col"><div class="h-20 flex items-center justify-center bg-emerald-900"><i data-lucide="leaf" class="w-10 h-10 mr-2 text-emerald-300"></i><h1 class="text-2xl font-bold tracking-wider">SolusiBK</h1></div><nav class="flex-1 px-4 py-4 space-y-1">${links}</nav></aside>`;
        }
        
        // --- DASHBOARDS ---
        async function SiswaDashboard() { /* ... unchanged ... */ return `<h3 class="text-3xl font-semibold text-emerald-900 mb-6">Selamat Datang, ${state.currentUser.name}!</h3><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><div class="bg-white p-6 rounded-xl shadow-lg flex items-center"><i data-lucide="calendar-check" class="w-12 h-12 text-emerald-500 mr-4"></i><div><p class="text-gray-500">Total Janji Temu Anda</p><p class="text-2xl font-bold">${(await supabase.from('appointments').select('*', { count: 'exact', head: true }).eq('student_id', state.currentUser.id)).count || 0}</p></div></div></div>`; }
        async function GuruBKDashboard() { /* ... unchanged ... */ return `<h3 class="text-3xl font-semibold text-emerald-900 mb-6">Selamat Datang, ${state.currentUser.name}!</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="bg-white p-6 rounded-xl shadow-lg flex items-center"><i data-lucide="calendar-clock" class="w-12 h-12 text-amber-500 mr-4"></i><div><p class="text-gray-500">Janji Temu Menunggu</p><p class="text-2xl font-bold">${(await supabase.from('appointments').select('*', { count: 'exact', head: true }).eq('status', 'Menunggu')).count || 0}</p></div></div></div>`;}
        async function AdminDashboard() { /* ... unchanged ... */ const { data: users, error: userError } = await supabase.from('profiles').select('role', { count: 'exact' }); const totalUsers = users ? users.length : 0; const totalSiswa = users ? users.filter(u => u.role === 'siswa').length : 0; const totalGuru = users ? users.filter(u => u.role.includes('guru')).length : 0; return `<h3 class="text-3xl font-semibold text-emerald-900 mb-6">Dashboard Admin</h3><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"><div class="bg-white p-6 rounded-xl shadow-lg flex items-center"><i data-lucide="users" class="w-12 h-12 text-emerald-500 mr-4"></i><div><p class="text-gray-500">Total Pengguna</p><p class="text-2xl font-bold">${totalUsers}</p></div></div><div class="bg-white p-6 rounded-xl shadow-lg flex items-center"><i data-lucide="graduation-cap" class="w-12 h-12 text-emerald-500 mr-4"></i><div><p class="text-gray-500">Jumlah Siswa</p><p class="text-2xl font-bold">${totalSiswa}</p></div></div><div class="bg-white p-6 rounded-xl shadow-lg flex items-center"><i data-lucide="briefcase" class="w-12 h-12 text-emerald-500 mr-4"></i><div><p class="text-gray-500">Jumlah Guru & Staf</p><p class="text-2xl font-bold">${totalGuru}</p></div></div></div>`;}

        // --- FITUR JANJI TEMU (UNCHANGED) ---
        async function SiswaJanjiTemu() { /* ... unchanged ... */ const { data: myAppointments, error: aptError } = await supabase.from('appointments').select(`*, counselor:profiles!counselor_id(name)`).eq('student_id', state.currentUser.id).order('created_at', { ascending: false }); const { data: counselors, error: counselorError } = await supabase.from('profiles').select('id, name').eq('role', 'guru_bk'); return `<h3 class="text-3xl font-semibold text-emerald-900 mb-6">Buat Janji Temu Konseling</h3><div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg"><h4 class="text-xl font-semibold text-emerald-800 mb-4">Formulir Janji Temu</h4><form id="janji-temu-form" class="space-y-4"><div><label class="block text-gray-700 text-sm font-medium">Pilih Guru BK</label><select id="counselor" class="w-full mt-1 p-2 border rounded-lg">${counselors.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}</select></div><div><label class="block text-gray-700 text-sm font-medium">Tanggal</label><input type="date" id="date" class="w-full mt-1 p-2 border rounded-lg" required></div><div><label class="block text-gray-700 text-sm font-medium">Waktu</label><input type="time" id="time" class="w-full mt-1 p-2 border rounded-lg" required></div><div><label class="block text-gray-700 text-sm font-medium">Topik Singkat</label><textarea id="topic" rows="3" class="w-full mt-1 p-2 border rounded-lg" required placeholder="Contoh: Kesulitan mengatur waktu belajar"></textarea></div><button type="submit" class="w-full bg-emerald-600 text-white py-2 rounded-lg font-semibold hover:bg-emerald-700 shadow-md transform hover:-translate-y-0.5 transition-all duration-300 active:scale-95 btn-glow-green">Ajukan Janji Temu</button></form></div><div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg"><h4 class="text-xl font-semibold text-emerald-800 mb-4">Riwayat Janji Temu Anda</h4><div class="space-y-3">${myAppointments && myAppointments.length > 0 ? myAppointments.map(apt => { const statusClass = apt.status === 'Disetujui' ? 'bg-green-100 text-green-700' : apt.status === 'Menunggu' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'; return `<div class="p-4 border rounded-lg bg-emerald-50 flex justify-between items-start"><div><p class="font-semibold">${apt.topic}</p><p class="text-sm text-gray-500">dengan ${apt.counselor.name} pada ${new Date(apt.date).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })} pukul ${apt.time}</p></div><span class="text-xs font-bold px-2 py-1 rounded-full ${statusClass}">${apt.status}</span></div>`}).join('') : '<p class="text-gray-500">Belum ada riwayat janji temu.</p>'}</div></div></div>`;}
        function attachSiswaJanjiTemuListeners() { /* ... unchanged ... */ document.getElementById('janji-temu-form')?.addEventListener('submit', async e => { e.preventDefault(); const newAppointment = { student_id: state.currentUser.id, counselor_id: document.getElementById('counselor').value, date: document.getElementById('date').value, time: document.getElementById('time').value, topic: document.getElementById('topic').value, status: 'Menunggu' }; const { error } = await supabase.from('appointments').insert(newAppointment); if (error) { showNotification("Gagal membuat janji temu: " + error.message, 'error'); } else { showNotification("Janji temu berhasil diajukan!", 'success'); render(); } }); }
        
        async function GuruBKJanjiTemu() {
            const { data: myAppointments, error } = await supabase.from('appointments').select('*, student:profiles(name)').order('created_at', { ascending: false });
            // Filter out appointments where the student has been deleted (student is null)
            const validAppointments = myAppointments ? myAppointments.filter(apt => apt.student) : [];
            
            return `<h3 class="text-3xl font-semibold text-emerald-900 mb-6">Kelola Janji Temu</h3><div class="bg-white p-6 rounded-xl shadow-lg"><div class="space-y-4">${validAppointments && validAppointments.length > 0 ? validAppointments.map(apt => `<div class="flex items-center justify-between p-4 border rounded-lg bg-emerald-50"><div><p class="font-bold text-lg">${apt.student.name}</p><p class="text-gray-600">${apt.topic}</p><p class="text-sm text-gray-500">${new Date(apt.date).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })} - ${apt.time}</p></div>${apt.status === 'Menunggu' ? `<div class="flex space-x-2"><button data-id="${apt.id}" class="approve-btn bg-green-500 text-white px-3 py-1 rounded-lg hover:bg-green-600 shadow-md btn-glow-green">Setujui</button><button data-id="${apt.id}" class="reject-btn bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 shadow-md btn-glow-red">Tolak</button></div>` : `<p class="font-medium ${apt.status === 'Disetujui' ? 'text-green-600' : 'text-red-600'}">${apt.status}</p>`}</div>`).join('') : '<p class="text-gray-500">Belum ada janji temu yang diajukan.</p>'}</div></div>`;
        }
        function attachGuruBKJanjiTemuListeners() { /* ... unchanged ... */ document.querySelectorAll('.approve-btn, .reject-btn').forEach(btn => { btn.addEventListener('click', async e => { const id = parseInt(e.currentTarget.getAttribute('data-id')); const newStatus = e.currentTarget.classList.contains('approve-btn') ? 'Disetujui' : 'Ditolak'; await supabase.from('appointments').update({ status: newStatus }).eq('id', id); showNotification(`Janji temu telah ${newStatus.toLowerCase()}.`, 'success'); render(); }); }); }
        
        // --- FITUR KELOLA PENGGUNA (UNCHANGED) ---
        async function AdminKelolaPengguna() { /* ... unchanged ... */ const { data: users, error } = await supabase.from('profiles').select('*').order('name', { ascending: true }); const roleMapping = { 'siswa': 'Siswa', 'guru_bk': 'Guru BK', 'admin': 'Admin' }; return `<div class="flex justify-between items-center mb-6"><h3 class="text-3xl font-semibold text-emerald-900">Kelola Pengguna</h3><button id="add-user-btn" class="bg-emerald-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-emerald-700 flex items-center shadow-md btn-glow-green"><i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i>Tambah Pengguna</button></div><div class="bg-white p-6 rounded-xl shadow-lg"><div class="overflow-x-auto"><table class="w-full"><thead><tr class="border-b-2"><th class="py-2 px-4 text-left">Nama</th><th class="py-2 px-4 text-left">ID Pengguna (UUID)</th><th class="py-2 px-4 text-left">Peran</th><th class="py-2 px-4 text-center">Aksi</th></tr></thead><tbody>${users ? users.map(user => `<tr class="border-b hover:bg-emerald-50"><td class="py-3 px-4">${user.name}</td><td class="py-3 px-4 text-sm text-gray-500 font-mono">${user.id}</td><td class="py-3 px-4">${roleMapping[user.role] || user.role}</td><td class="py-3 px-4 text-center">${user.id !== state.currentUser.id ? `<button data-id="${user.id}" data-name="${user.name}" class="delete-user-btn text-red-500 hover:text-red-700"><i data-lucide="trash-2" class="w-5 h-5"></i></button>` : '<span class="text-xs text-gray-400">Anda</span>'}</td></tr>`).join('') : ''}</tbody></table></div></div>`;}
        function attachAdminKelolaPenggunaListeners() { /* ... unchanged ... */ document.getElementById('add-user-btn')?.addEventListener('click', () => showAddUserModal()); document.querySelectorAll('.delete-user-btn').forEach(btn => { btn.addEventListener('click', e => { const id = e.currentTarget.getAttribute('data-id'); const name = e.currentTarget.getAttribute('data-name'); showDeleteUserModal(id, name); }); }); }

        // --- FITUR MATERI BK ---
        /*
            PENTING: Buat tabel baru di Supabase bernama 'materials'
            dengan kolom-kolom berikut:
            - id (int8, is identity, is primary key)
            - created_at (timestamptz, default: now())
            - title (text)
            - content (text)
        */
        async function SiswaMateriBk() {
            const { data: materials, error } = await supabase.from('materials').select('*').order('created_at', { ascending: false });
            if (error) { return `<p class="text-red-500">Gagal memuat materi.</p>`; }

            return `
                <h3 class="text-3xl font-semibold text-emerald-900 mb-6">Materi Bimbingan Konseling</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${materials.length > 0 ? materials.map(m => `
                        <div class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-300 flex flex-col">
                            <h4 class="text-xl font-bold text-emerald-800 mb-2">${m.title}</h4>
                            <p class="text-gray-600 flex-grow">${m.content.substring(0, 100)}...</p>
                            <button data-id="${m.id}" class="view-material-btn mt-4 text-emerald-600 font-semibold self-start">Baca Selengkapnya →</button>
                        </div>
                    `).join('') : '<p class="text-gray-500 col-span-full">Belum ada materi yang tersedia.</p>'}
                </div>
            `;
        }

        function attachSiswaMateriBkListeners() {
            document.querySelectorAll('.view-material-btn').forEach(btn => {
                btn.addEventListener('click', async e => {
                    const materialId = e.currentTarget.dataset.id;
                    const { data: material, error } = await supabase.from('materials').select('*').eq('id', materialId).single();
                    if (material) {
                        showViewMaterialModal(material);
                    }
                });
            });
        }
        
        async function AdminKelolaMateri() {
            const { data: materials, error } = await supabase.from('materials').select('*').order('created_at', { ascending: false });
             return `
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-3xl font-semibold text-emerald-900">Kelola Materi BK</h3>
                    <button id="add-material-btn" class="bg-emerald-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-emerald-700 flex items-center shadow-md btn-glow-green">
                        <i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i>Tambah Materi
                    </button>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                     <div class="space-y-4">
                        ${materials && materials.length > 0 ? materials.map(m => `
                            <div class="flex items-center justify-between p-4 border rounded-lg bg-emerald-50">
                                <div>
                                    <p class="font-bold text-lg">${m.title}</p>
                                    <p class="text-gray-600">${m.content.substring(0, 80)}...</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button data-id="${m.id}" class="edit-material-btn text-blue-500 hover:text-blue-700"><i data-lucide="edit" class="w-5 h-5"></i></button>
                                    <button data-id="${m.id}" data-title="${m.title}" class="delete-material-btn text-red-500 hover:text-red-700"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                                </div>
                            </div>
                        `).join('') : '<p class="text-gray-500">Belum ada materi. Silakan tambahkan.</p>'}
                    </div>
                </div>
            `;
        }
        
        function attachAdminKelolaMateriListeners() {
            document.getElementById('add-material-btn')?.addEventListener('click', () => showAddMaterialModal());
            document.querySelectorAll('.edit-material-btn').forEach(btn => {
                btn.addEventListener('click', async e => {
                    const id = e.currentTarget.getAttribute('data-id');
                    const { data: material } = await supabase.from('materials').select('*').eq('id', id).single();
                    if(material) showEditMaterialModal(material);
                });
            });
            document.querySelectorAll('.delete-material-btn').forEach(btn => {
                btn.addEventListener('click', e => {
                    const id = e.currentTarget.getAttribute('data-id');
                    const title = e.currentTarget.getAttribute('data-title');
                    showDeleteMaterialModal(id, title);
                });
            });
        }

        // --- FITUR CHAT ---
        /*
            PENTING: Buat tabel baru di Supabase bernama 'messages'
            dengan kolom-kolom berikut:
            - id (int8, is identity, is primary key)
            - created_at (timestamptz, default: now())
            - content (text)
            - sender_id (uuid, foreign key ke profiles.id)
            - receiver_id (uuid, foreign key ke profiles.id)
        */
        async function SiswaChat() {
            const { data: counselors, error } = await supabase.from('profiles').select('id, name').eq('role', 'guru_bk');
            return ChatLayout(counselors, 'Guru BK');
        }
        async function GuruBKChat() {
            const { data: students, error } = await supabase
                .from('messages')
                .select('sender:sender_id(id, name)')
                .eq('receiver_id', state.currentUser.id);

            // Get unique students, filtering out any null senders (deleted users)
            const uniqueStudents = students 
                ? [...new Map(
                    students
                        .filter(item => item.sender)
                        .map(item => [item.sender.id, item.sender])
                  ).values()] 
                : [];
            return ChatLayout(uniqueStudents, 'Siswa');
        }
        function ChatLayout(users, userRole) {
            return `
                <h3 class="text-3xl font-semibold text-emerald-900 mb-6">Chat Konseling</h3>
                <div class="grid grid-cols-12 gap-6 h-[calc(100vh-200px)]">
                    <!-- Contact List -->
                    <div class="col-span-4 bg-white rounded-xl shadow-lg overflow-y-auto">
                        <div class="p-4 border-b">
                            <h4 class="font-semibold text-lg text-emerald-800">Kontak ${userRole}</h4>
                        </div>
                        <ul class="divide-y">
                            ${users && users.length > 0 ? users.map(user => `
                                <li>
                                    <a href="#" data-id="${user.id}" data-name="${user.name}" class="contact-item flex items-center p-4 hover:bg-emerald-50 ${state.activeChatPartner?.id === user.id ? 'bg-emerald-100' : ''}">
                                        <div class="w-10 h-10 rounded-full bg-emerald-200 text-emerald-700 flex items-center justify-center font-bold mr-3">${user.name.charAt(0)}</div>
                                        <span>${user.name}</span>
                                    </a>
                                </li>
                            `).join('') : `<li class="p-4 text-gray-500">Tidak ada kontak tersedia.</li>`}
                        </ul>
                    </div>
                    <!-- Chat Window -->
                    <div id="chat-window-container" class="col-span-8 bg-white rounded-xl shadow-lg flex flex-col">
                        ${state.activeChatPartner ? ChatWindow(state.activeChatPartner) : WelcomeChatScreen()}
                    </div>
                </div>
            `;
        }
        function WelcomeChatScreen() {
            return `
                <div class="flex flex-col items-center justify-center h-full text-center text-gray-500">
                    <i data-lucide="messages-square" class="w-24 h-24 text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-semibold">Pilih Kontak</h3>
                    <p>Silakan pilih kontak dari daftar di sebelah kiri untuk memulai percakapan.</p>
                </div>
            `;
        }
        function ChatWindow(partner) {
            return `
                <div class="p-4 border-b flex items-center">
                    <div class="w-10 h-10 rounded-full bg-emerald-200 text-emerald-700 flex items-center justify-center font-bold mr-3">${partner.name.charAt(0)}</div>
                    <h4 class="font-semibold text-lg text-emerald-800">${partner.name}</h4>
                </div>
                <div id="message-list" class="flex-grow p-4 space-y-4 overflow-y-auto">
                    <!-- Messages will be rendered here by JS -->
                    <div class="text-center"><i data-lucide="loader-2" class="animate-spin w-8 h-8 text-emerald-500"></i></div>
                </div>
                <div class="p-4 border-t">
                    <form id="chat-form" class="flex gap-3">
                        <input type="text" id="chat-input" class="w-full p-2 border rounded-lg" placeholder="Ketik pesan..." autocomplete="off" required>
                        <button type="submit" class="bg-emerald-600 text-white px-4 rounded-lg font-semibold hover:bg-emerald-700 shadow-md btn-glow-green flex items-center"><i data-lucide="send" class="w-5 h-5"></i></button>
                    </form>
                </div>
            `;
        }
        function renderMessages(messages) {
            const messageListEl = document.getElementById('message-list');
            if (!messageListEl) return;
            messageListEl.innerHTML = messages.length > 0 ? messages.map(msg => {
                const isSent = msg.sender_id === state.currentUser.id;
                return `
                    <div class="flex ${isSent ? 'justify-end' : 'justify-start'}">
                        <div class="max-w-xs md:max-w-md p-3 ${isSent ? 'chat-bubble-sent' : 'chat-bubble-received'}">
                            <p>${msg.content}</p>
                            <p class="text-xs opacity-75 mt-1 text-right">${new Date(msg.created_at).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}</p>
                        </div>
                    </div>
                `;
            }).join('') : `<p class="text-center text-gray-400">Belum ada pesan. Mulai percakapan!</p>`;
            messageListEl.scrollTop = messageListEl.scrollHeight;
        }
        async function selectChatPartner(partnerId, partnerName) {
            state.activeChatPartner = { id: partnerId, name: partnerName };
            
            // Unsubscribe from old channel if exists
            if (state.messageSubscription) {
                supabase.removeChannel(state.messageSubscription);
                state.messageSubscription = null;
            }

            const chatWindowContainer = document.getElementById('chat-window-container');
            if(chatWindowContainer) {
                chatWindowContainer.innerHTML = ChatWindow(state.activeChatPartner);
                lucide.createIcons();
                attachChatFormListener();
            }

            const { data, error } = await supabase.from('messages')
                .select('*')
                .or(`(sender_id.eq.${state.currentUser.id},receiver_id.eq.${partnerId}),(sender_id.eq.${partnerId},receiver_id.eq.${state.currentUser.id})`)
                .order('created_at', { ascending: true });
            
            if (data) {
                state.messages = data;
                renderMessages(state.messages);
            }
            
            // Subscribe to new messages
            state.messageSubscription = supabase.channel(`chat-${state.currentUser.id}-${partnerId}`)
                .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
                    const newMessage = payload.new;
                    // Check if the message belongs to this chat
                    if ((newMessage.sender_id === state.currentUser.id && newMessage.receiver_id === partnerId) || 
                        (newMessage.sender_id === partnerId && newMessage.receiver_id === state.currentUser.id)) {
                        state.messages.push(newMessage);
                        renderMessages(state.messages);
                    }
                })
                .subscribe();
        }
        function attachChatListeners() {
            document.querySelectorAll('.contact-item').forEach(item => {
                item.addEventListener('click', e => {
                    e.preventDefault();
                    document.querySelectorAll('.contact-item').forEach(i => i.classList.remove('bg-emerald-100'));
                    e.currentTarget.classList.add('bg-emerald-100');
                    const partnerId = e.currentTarget.dataset.id;
                    const partnerName = e.currentTarget.dataset.name;
                    selectChatPartner(partnerId, partnerName);
                });
            });
            if (state.activeChatPartner) {
                attachChatFormListener();
            }
        }
        function attachChatFormListener() {
             document.getElementById('chat-form')?.addEventListener('submit', async e => {
                e.preventDefault();
                const input = document.getElementById('chat-input');
                const content = input.value.trim();
                if (content && state.activeChatPartner) {
                    const message = {
                        sender_id: state.currentUser.id,
                        receiver_id: state.activeChatPartner.id,
                        content: content
                    };
                    input.value = '';
                    await supabase.from('messages').insert(message);
                }
            });
        }

        // --- MODAL SYSTEM & HANDLERS ---
        function openModal(header, content) { state.modal = { isOpen: true, header, content }; render(); }
        function closeModal() { state.modal.isOpen = false; render(); }
        function renderModal() {
             const modalHTML = `<div id="modal-backdrop" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 transition-opacity duration-300"><div id="modal-content" class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col transform scale-95 opacity-0 transition-all duration-300"><div class="flex-shrink-0 flex justify-between items-center">${state.modal.header} <button id="close-modal-x" class="text-gray-400 hover:text-gray-600">&times;</button></div><div class="overflow-y-auto mt-4">${state.modal.content}</div></div></div>`;
             if (!document.getElementById('modal-backdrop')) {
                 document.body.insertAdjacentHTML('beforeend', modalHTML);
                 setTimeout(() => { document.getElementById('modal-backdrop').classList.add('opacity-100'); document.getElementById('modal-content').classList.remove('scale-95','opacity-0'); document.getElementById('modal-content').classList.add('scale-100','opacity-100');}, 10);
                 lucide.createIcons();
                 document.getElementById('modal-backdrop').addEventListener('click', e => e.target.id === 'modal-backdrop' && closeModal());
                 document.getElementById('close-modal-x').addEventListener('click', closeModal);
             }
        }
        function showViewMaterialModal(material) {
            const header = `<h3 class="text-2xl font-bold text-emerald-800">${material.title}</h3>`;
            const content = `<div class="prose">${material.content.replace(/\n/g, '<br>')}</div>`;
            openModal(header, content);
        }
        function showAddMaterialModal() {
            const header = `<h3 class="text-2xl font-bold text-emerald-800">Tambah Materi Baru</h3>`;
            const content = `<form id="add-material-form" class="space-y-4"><div><label class="block text-sm">Judul</label><input type="text" id="new-material-title" class="w-full mt-1 p-2 border rounded-lg" required></div><div><label class="block text-sm">Konten</label><textarea id="new-material-content" rows="10" class="w-full mt-1 p-2 border rounded-lg" required></textarea></div><div class="text-right pt-4"><button type="submit" class="bg-emerald-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-emerald-700 shadow-md btn-glow-green">Simpan</button></div></form>`;
            openModal(header, content);
            document.getElementById('add-material-form')?.addEventListener('submit', handleAddMaterial);
        }
        async function handleAddMaterial(e) {
            e.preventDefault();
            const title = document.getElementById('new-material-title').value;
            const content = document.getElementById('new-material-content').value;
            const { error } = await supabase.from('materials').insert({ title, content });
            if (error) { showNotification(`Gagal: ${error.message}`, 'error'); } 
            else { showNotification("Materi berhasil ditambahkan!", 'success'); closeModal(); render(); }
        }
        function showEditMaterialModal(material) {
            const header = `<h3 class="text-2xl font-bold text-emerald-800">Edit Materi</h3>`;
            const content = `<form id="edit-material-form" class="space-y-4"><div><label class="block text-sm">Judul</label><input type="text" id="edit-material-title" class="w-full mt-1 p-2 border rounded-lg" value="${material.title}" required></div><div><label class="block text-sm">Konten</label><textarea id="edit-material-content" rows="10" class="w-full mt-1 p-2 border rounded-lg" required>${material.content}</textarea></div><div class="text-right pt-4"><button type="submit" class="bg-emerald-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-emerald-700 shadow-md btn-glow-green">Update</button></div></form>`;
            openModal(header, content);
            document.getElementById('edit-material-form')?.addEventListener('submit', (e) => handleEditMaterial(e, material.id));
        }
        async function handleEditMaterial(e, id) {
            e.preventDefault();
            const title = document.getElementById('edit-material-title').value;
            const content = document.getElementById('edit-material-content').value;
            const { error } = await supabase.from('materials').update({ title, content }).eq('id', id);
            if (error) { showNotification(`Gagal: ${error.message}`, 'error'); }
            else { showNotification("Materi berhasil diperbarui!", 'success'); closeModal(); render(); }
        }
        function showDeleteMaterialModal(id, title) {
             const header = `<h3 class="text-2xl font-bold text-red-600">Hapus Materi</h3>`;
             const content = `<p>Apakah Anda yakin ingin menghapus materi <strong>${title}</strong>?</p><div class="text-right pt-4 flex gap-2 justify-end"><button id="cancel-delete" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">Batal</button><button id="confirm-delete" class="bg-red-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700">Ya, Hapus</button></div>`;
             openModal(header, content);
             document.getElementById('cancel-delete').addEventListener('click', closeModal);
             document.getElementById('confirm-delete').addEventListener('click', () => handleDeleteMaterial(id));
        }
        async function handleDeleteMaterial(id) {
            const { error } = await supabase.from('materials').delete().eq('id', id);
            if (error) { showNotification(`Gagal: ${error.message}`, 'error'); }
            else { showNotification("Materi berhasil dihapus.", 'success'); closeModal(); render(); }
        }
        
        // --- MODAL PENGGUNA (UNCHANGED) ---
        function showAddUserModal() { /* ... unchanged ... */ const header = `<h3 class="text-2xl font-bold text-emerald-800">Tambah Pengguna Baru</h3>`; const content = `<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4" role="alert"><p class="font-bold">Penting!</p><p>Membuat pengguna dari sisi klien tidak disarankan untuk produksi. Gunakan Supabase Edge Function untuk keamanan maksimal.</p></div><form id="add-user-form" class="space-y-4"><div><label class="block text-sm">Email</label><input type="email" id="new-user-email" class="w-full mt-1 p-2 border rounded-lg" required></div><div><label class="block text-sm">Nama Lengkap</label><input type="text" id="new-user-name" class="w-full mt-1 p-2 border rounded-lg" required></div><div><label class="block text-sm">Password</label><input type="password" id="new-user-password" class="w-full mt-1 p-2 border rounded-lg" required></div><div><label class="block text-sm">Peran</label><select id="new-user-role" class="w-full mt-1 p-2 border rounded-lg"><option value="siswa">Siswa</option><option value="guru_bk">Guru BK</option></select></div><p id="add-user-error" class="text-red-500 text-sm hidden"></p><div class="text-right pt-4 flex gap-2 justify-end"><button type="button" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 shadow-md btn-glow-gray" id="cancel-add-user">Batal</button><button type="submit" class="bg-emerald-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-emerald-700 shadow-md btn-glow-green">Simpan</button></div></form>`; openModal(header, content); document.getElementById('cancel-add-user')?.addEventListener('click', closeModal); document.getElementById('add-user-form')?.addEventListener('submit', handleAddUser); }
        async function handleAddUser(e) { /* ... unchanged ... */ e.preventDefault(); const email = document.getElementById('new-user-email').value; const password = document.getElementById('new-user-password').value; const name = document.getElementById('new-user-name').value; const role = document.getElementById('new-user-role').value; const errorEl = document.getElementById('add-user-error'); const { data, error } = await supabase.functions.invoke('create-user', { body: { email, password, name, role }, }); if (error) { errorEl.textContent = `Gagal menambah pengguna: ${error.message}`; errorEl.classList.remove('hidden'); console.error('Function invoke error:', error); } else if (data.error) { errorEl.textContent = `Gagal menambah pengguna: ${data.error}`; errorEl.classList.remove('hidden'); console.error('Function logic error:', data.error); } else { showNotification("Pengguna baru berhasil ditambahkan!", 'success'); closeModal(); render(); } }
        function showDeleteUserModal(userId, userName) { /* ... unchanged ... */ const header = `<h3 class="text-2xl font-bold text-red-600">Hapus Pengguna</h3>`; const content = `<p>Apakah Anda yakin ingin menghapus pengguna <strong>${userName}</strong>? Tindakan ini tidak dapat diurungkan.</p><div class="text-right pt-4 flex gap-2 justify-end"><button id="cancel-delete" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">Batal</button><button id="confirm-delete" class="bg-red-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700">Ya, Hapus</button></div>`; openModal(header, content); document.getElementById('cancel-delete').addEventListener('click', closeModal); document.getElementById('confirm-delete').addEventListener('click', () => handleDeleteUser(userId)); }
        async function handleDeleteUser(userId) { /* ... unchanged ... */ const { error } = await supabase.functions.invoke('delete-user', { body: { id: userId } }); if (error) { showNotification(`Gagal menghapus pengguna: ${error.message}`, 'error'); } else { showNotification("Pengguna berhasil dihapus.", 'success'); closeModal(); render(); } }

        // --- UTILITIES ---
        function showNotification(message, type = 'success') { const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500'; const notification = document.createElement('div'); notification.className = `fixed top-5 right-5 ${bgColor} text-white py-2 px-4 rounded-lg shadow-lg transform translate-x-full animate-slide-in`; notification.textContent = message; document.body.appendChild(notification); setTimeout(() => { notification.classList.remove('animate-slide-in'); notification.classList.add('animate-slide-out'); setTimeout(() => { document.body.removeChild(notification); }, 500); }, 3000); }
        const styleSheet = document.createElement("style"); styleSheet.type = "text/css"; styleSheet.innerText = `@keyframes slide-in { from { transform: translateX(100%); } to { transform: translateX(0); } } .animate-slide-in { animation: slide-in 0.5s forwards; } @keyframes slide-out { from { transform: translateX(0); } to { transform: translateX(110%); } } .animate-slide-out { animation: slide-out 0.5s forwards; }`; document.head.appendChild(styleSheet);


        // --- INISIALISASI APLIKASI ---
        async function initializeApp() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) { await fetchUserProfile(session.user); }
            render();
            supabase.auth.onAuthStateChange((event, session) => {
                if (event === 'SIGNED_OUT') {
                    state.currentUser = null;
                    render();
                } else if (event === 'SIGNED_IN' && session) {
                    fetchUserProfile(session.user).then(render);
                }
            });
        }
        initializeApp();
    </script>
</body>
</html>
